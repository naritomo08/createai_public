{% extends "base2.html" %}

{% block content %}
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <h2 class="text-center mt-5">実行結果(リロードするとトップに戻ります。)</h2>
                <h3 class="mt-4">ステータス: {{ status }}</h3>
                <h3 class="mt-4">パラメータ</h3>
                <pre class="bg-light p-3 border">{{ parameters }}</pre>
                <h3 class="mt-4">出力</h3>
                <pre class="bg-light p-3 border">{{ output }}</pre>
                <h3 class="mt-4">エラー</h3>
                <pre class="bg-light p-3 border">{{ error }}</pre>

                <!-- 生成された画像 -->
                <h3 class="mt-4">生成された画像</h3>
                <div class="mt-2">
                    {% if png_filepath %}
                    <a href="#" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#imageModal" data-bs-image="{{ png_filepath }}">View PNG</a>
                    {% endif %}
                    {% if jpg_filepath %}
                    <a href="#" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#imageModal" data-bs-image="{{ jpg_filepath }}">View JPG</a>
                    {% endif %}
                </div>

                <div class="mt-4">
                    <button class="btn btn-secondary" onclick='reflectToTop({{ parameters|tojson|safe }})'>トップに反映(高解像度化設定は除く)</button>
                </div>
                <div class="mt-4">
                    <a href="/" class="btn btn-primary">戻る</a>
                </div>
                <div class="mt-3">
                    <form id="cancelForm" method="post" action="/cancel_task">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <input type="hidden" name="task_id" value="{{ task_id }}">
                        <button type="submit" onclick="return confirmCancel()" class="btn btn-danger">タスクを削除</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="imageModal" tabindex="-1" aria-labelledby="imageModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="imageModalLabel">画像プレビュー</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center">
                    <img id="modalImage" src="" alt="Generated Image" class="img-fluid">
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block scripts %}
    <script>
        var imageModal = document.getElementById('imageModal');
        imageModal.addEventListener('show.bs.modal', function (event) {
            var button = event.relatedTarget; // ボタンを取得
            var imageUrl = button.getAttribute('data-bs-image'); // data-bs-image 属性からURLを取得
            var modalImage = document.getElementById('modalImage');
            modalImage.src = imageUrl; // モーダルの画像を更新
        });
    </script>
{% endblock %}
